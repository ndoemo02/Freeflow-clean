<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FreeFlow ‚Äî Voice to order</title>
  <meta name="theme-color" content="#111625" />

  <!-- Styl: lekki, ciemny, pomara≈Ñczowe akcenty -->
  <style>
    :root{
      --bg:#0c0f14; --panel:#141823; --card:#111625; --muted:#95a3b9;
      --txt:#e8edf7; --sub:#c2cbe0; --accent:#ff7a1a; --accent-2:#ff9340;
      --ok:#2ecc71; --err:#ff4d4f; --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt); background:var(--bg);
      background-image: radial-gradient(1200px 800px at 10% -10%, rgba(255,122,26,.15), transparent 60%),
                       radial-gradient(1000px 600px at 110% -20%, rgba(255,147,64,.12), transparent 60%);
    }
    /* t≈Ço foto */
    .hero{
      position:relative; border-radius:calc(var(--radius) + 6px);
      overflow:hidden; box-shadow:var(--shadow); margin:24px 0 18px;
    }
    .hero::before{
      content:""; position:absolute; inset:0;
      background:url("./images/Background.png") center/cover no-repeat;
      filter:brightness(.45) blur(.2px);
      transform:scale(1.02);
    }
    .hero-inner{position:relative; padding:34px 22px 28px}
    h1{margin:0 0 8px; font-size:42px; line-height:1.1; letter-spacing:.3px}
    .subtitle{color:var(--sub); font-size:18px}

    /* top bar */
    .top{
      display:flex; align-items:center; justify-content:space-between;
      padding:16px 14px 0; gap:12px;
    }
    .brand{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.2px; font-size:26px}
    .brand .free{color:var(--accent)}
    .actions{display:flex; gap:10px}
    .icon-btn{
      width:44px; height:44px; border-radius:16px; background:rgba(255,255,255,.06);
      display:grid; place-items:center; border:1px solid rgba(255,255,255,.08); backdrop-filter: blur(4px);
    }
    .pill{
      display:inline-flex; align-items:center; gap:10px; background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08); padding:14px; border-radius:var(--radius);
    }
    .pill input{
      width:100%; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,.08);
      background:#0f1420; color:var(--txt); outline:none;
    }
    .btn{
      appearance:none; border:none; cursor:pointer; font-weight:600; color:#0b111b;
      background:linear-gradient(135deg,var(--accent),var(--accent-2)); padding:12px 18px;
      border-radius:14px; transition:.15s transform ease; box-shadow:0 6px 16px rgba(255,122,26,.26);
    }
    .btn:active{transform:translateY(1px)}
    .btn.secondary{background:#1d2433; color:var(--txt); border:1px solid rgba(255,255,255,.08); box-shadow:none}

    /* menu (hamburger) */
    .drawer{position:fixed; inset:0; display:none}
    .drawer.open{display:block}
    .backdrop{position:absolute; inset:0; background:rgba(0,0,0,.45)}
    .sheet{
      position:absolute; right:0; top:0; bottom:0; width:min(92vw,420px);
      background:var(--panel); border-left:1px solid rgba(255,255,255,.08);
      padding:18px; overflow:auto;
    }
    .sheet h3{margin:4px 2px 14px; font-size:18px; color:var(--sub)}
    .menu-section{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.08);
      border-radius:16px; padding:14px; margin:12px 0}
    .menu-item{padding:12px 10px; border-radius:12px; background:#0f1420; margin:8px 0; border:1px solid rgba(255,255,255,.06)}
    .menu-title{font-weight:700; color:var(--txt)}

    /* karty */
    .card{
      background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius); padding:16px; margin:10px 0; box-shadow:var(--shadow);
    }
    .label{color:var(--sub); font-size:14px; margin-bottom:10px}

    /* asystent */
    textarea{
      width:100%; min-height:120px; resize:vertical; padding:12px 14px; line-height:1.4;
      color:var(--txt); background:#0f1420; border:1px solid rgba(255,255,255,.08); border-radius:12px;
    }
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .status{font-size:14px; color:var(--sub); display:flex; gap:8px; align-items:center}
    .ok{color:var(--ok)} .bad{color:var(--err)}

    /* logo w hero */
    .logo-wrap{display:grid; place-items:center; padding:20px 0 8px}
    .logo{
      width:min(420px,70vw);
      filter: drop-shadow(0 14px 36px rgba(255,122,26,.35));
    }

    /* d√≥≈Ç: szybkie kafelki */
    .tiles{display:flex; gap:12px; padding:14px 2px 44px}
    .tile{
      flex:1; background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.08);
      border-radius:20px; padding:16px; text-align:center; font-weight:700;
    }

    @media (min-width:960px){
      .container{max-width:1000px; margin:0 auto; padding:0 14px}
      h1{font-size:56px}
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Top bar -->
    <div class="top">
      <div class="brand"><span class="free">Free</span>Flow</div>
      <div class="actions">
        <div class="icon-btn" title="Koszyk" aria-label="Koszyk">
          üõí
        </div>
        <button id="hamburger" class="icon-btn" title="Menu" aria-label="Menu">‚â°</button>
      </div>
    </div>

    <!-- HERO: t≈Ço + logo + mic -->
    <section class="hero">
      <div class="hero-inner">
        <h1>Voice to order ‚Äî<br/>Z≈Ç√≥≈º zam√≥wienie</h1>
        <div class="subtitle">Restauracja, taxi albo hotel?</div>
        <div class="logo-wrap">
          <img class="logo" src="./images/Freeflowlogo.png" alt="FreeFlow Logo"/>
        </div>
        <div class="row" style="justify-content:center; gap:12px; padding:6px 0 4px;">
          <button id="recBtn" class="btn secondary">üéôÔ∏è Nagraj</button>
          <button id="stopBtn" class="btn secondary" disabled>‚èπÔ∏è Stop</button>
          <button id="ttsBtn" class="btn">üîä Odtw√≥rz odpowied≈∫</button>
        </div>
      </div>
    </section>

    <!-- Konfiguracja backendu -->
    <section class="card">
      <div class="label">URL backendu (Vercel)</div>
      <div class="row">
        <div class="pill" style="flex:1 1 360px;">
          <input id="backendUrl" placeholder="https://twoj-backend.vercel.app"/>
        </div>
        <button id="saveUrl" class="btn">Zapisz</button>
        <button id="pingBtn" class="btn secondary">Ping /health</button>
      </div>
      <div class="status" style="margin-top:10px;">Stan: <span id="healthState">nieznany</span></div>
    </section>

    <!-- Asystent -->
    <section class="card">
      <div class="label">Asystent ‚Äî kr√≥tkie odpowiedzi PL <span style="opacity:.6">(model: gpt-4o-mini)</span></div>
      <div style="color:var(--muted); font-size:14px; margin-bottom:10px;">
        Przyk≈Çad: ‚ÄûZam√≥wiƒá dwie pizze na Kazimierzu ‚Äî jaka dzielnica?‚Äù
      </div>
      <textarea id="prompt" placeholder="Napisz, co chcesz za≈Çatwiƒá‚Ä¶"></textarea>
      <div class="row" style="margin-top:12px">
        <button id="sendBtn" class="btn">Wy≈õlij do /api/gpt</button>
        <button id="clearBtn" class="btn secondary">Wyczy≈õƒá</button>
      </div>
      <div class="label" style="margin-top:14px;">Odpowied≈∫</div>
      <textarea id="answer" placeholder="Tu pojawi siƒô odpowied≈∫‚Ä¶" readonly></textarea>
    </section>

    <!-- skr√≥ty -->
    <div class="tiles">
      <div class="tile">üçΩÔ∏è Jedzenie</div>
      <div class="tile">üöï Taxi</div>
      <div class="tile">üè® Hotele</div>
    </div>
  </div>

  <!-- Drawer (hamburger) -->
  <div id="drawer" class="drawer" aria-hidden="true">
    <div class="backdrop" role="button" aria-label="Zamknij menu"></div>
    <aside class="sheet" role="dialog" aria-label="Menu">
      <div class="row" style="justify-content:space-between; align-items:center; margin-bottom:8px;">
        <div class="brand"><span class="free">Free</span>Flow</div>
        <button id="closeDrawer" class="icon-btn" aria-label="Zamknij">‚úï</button>
      </div>

      <div class="menu-section">
        <div class="menu-title">Klient Prywatny</div>
        <div class="menu-item">Zaloguj siƒô</div>
        <div class="menu-item">Zarejestruj konto</div>
        <div class="menu-item">Moje zam√≥wienia</div>
        <div class="menu-item">Ulubione restauracje</div>
      </div>

      <div class="menu-section">
        <div class="menu-title">Firma</div>
        <div class="menu-item">Panel firmy</div>
        <div class="menu-item">Fakturowanie</div>
      </div>

      <div class="menu-section">
        <div class="menu-title">Wsparcie i Ustawienia</div>
        <div class="menu-item">FAQ / pomoc</div>
        <div class="menu-item">Ustawienia aplikacji</div>
        <div class="menu-item">Jƒôzyk / waluta</div>
      </div>
    </aside>
  </div>

  <script>
    // ====== Utilities ======
    const $ = sel => document.querySelector(sel);
    const backendUrlInput = $('#backendUrl');
    const healthState = $('#healthState');
    const promptEl = $('#prompt');
    const answerEl = $('#answer');

    // Persist backend URL
    const LS_KEY = 'freeflow.backendUrl';
    function loadUrl(){
      const stored = localStorage.getItem(LS_KEY);
      if(stored) backendUrlInput.value = stored;
    }
    function saveUrl(){
      const val = (backendUrlInput.value || '').trim();
      if(!val){ alert('Podaj URL backendu (https://‚Ä¶vercel.app)'); return; }
      localStorage.setItem(LS_KEY, val);
      toast('Zapisano URL backendu.');
    }

    // Simple toast
    let toastTm;
    function toast(msg){
      clearTimeout(toastTm);
      let t = document.getElementById('toast');
      if(!t){
        t = document.createElement('div'); t.id='toast';
        t.style.cssText = 'position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:#101725;color:#e8edf7;border:1px solid rgba(255,255,255,.1);padding:10px 14px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.35);z-index:9999';
        document.body.appendChild(t);
      }
      t.textContent = msg; t.style.opacity = '1';
      toastTm = setTimeout(()=> t.style.opacity = '0', 1800);
    }

    // Health check
    async function pingHealth(){
      const base = backendUrlInput.value.trim();
      if(!base) return toast('Ustaw URL backendu.');
      healthState.textContent = 'sprawdzam‚Ä¶';
      try{
        const r = await fetch(base.replace(/\/$/,'') + '/api/health', {headers:{'accept':'application/json'}});
        const ok = r.ok;
        healthState.textContent = ok ? 'OK' : 'b≈ÇƒÖd';
        healthState.className = ok ? 'ok' : 'bad';
      }catch(e){
        healthState.textContent = 'b≈ÇƒÖd'; healthState.className='bad';
      }
    }

    // GPT call
    async function sendPrompt(){
      const base = backendUrlInput.value.trim();
      if(!base) return toast('Ustaw URL backendu.');
      const prompt = promptEl.value.trim();
      if(!prompt) return toast('Wpisz wiadomo≈õƒá.');
      answerEl.value = '‚Ä¶';
      try{
        const r = await fetch(base.replace(/\/$/,'') + '/api/gpt', {
          method:'POST',
          headers:{'content-type':'application/json','accept':'application/json'},
          body: JSON.stringify({ prompt })
        });
        const data = await r.json().catch(()=> ({}));
        const text = (data.reply || data.text || JSON.stringify(data, null, 2) || '').toString();
        answerEl.value = text || '[brak odpowiedzi]';
      }catch(e){
        answerEl.value = '‚ùå B≈ÇƒÖd ≈ºƒÖdania: ' + e.message;
      }
    }

    // TTS ‚Äì Web Speech Synthesis (lokalnie, bez watermark√≥w)
    function speak(){
      const txt = (answerEl.value || promptEl.value || '').trim();
      if(!txt) return toast('Brak tre≈õci do odtworzenia.');
      if(!('speechSynthesis' in window)) return toast('TTS niedostƒôpny w tej przeglƒÖdarce.');
      const u = new SpeechSynthesisUtterance(txt);
      u.lang = 'pl-PL';
      u.rate = 1.0; u.pitch = 1.0;
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    }

    // Nagrywanie (MediaRecorder -> opcjonalny upload do /api/transcribe je≈õli istnieje)
    let mediaRec, chunks=[];
    async function startRec(){
      try{
        const stream = await navigator.mediaDevices.getUserMedia({audio:true});
        mediaRec = new MediaRecorder(stream, {mimeType:'audio/webm'});
        chunks = [];
        mediaRec.ondataavailable = e => e.data.size && chunks.push(e.data);
        mediaRec.onstop = async () => {
          const blob = new Blob(chunks, {type:'audio/webm'}); //  ~50‚Äì100 KB / parƒô sekund
          // Opcjonalnie wy≈õlij do /api/transcribe, je≈õli endpoint jest w backendzie:
          const base = (backendUrlInput.value || '').trim();
          if(!base){ toast('Audio nagrane. Ustaw URL backendu, aby wys≈Çaƒá.'); return; }
          try{
            const r = await fetch(base.replace(/\/$/,'') + '/api/transcribe', {
              method:'POST',
              body: (()=>{ const fd = new FormData(); fd.append('file', blob, 'voice.webm'); return fd; })()
            });
            if(r.ok){
              const data = await r.json().catch(()=> ({}));
              const txt = data.text || data.transcript || '';
              if(txt){ promptEl.value = txt; toast('Rozpoznano mowƒô.'); }
              else toast('Audio wys≈Çane, odpowied≈∫ brak.');
            }else{
              toast('Endpoint /api/transcribe niedostƒôpny (to tylko opcja).');
            }
          }catch{ toast('Nie uda≈Ço siƒô wys≈Çaƒá audio.'); }
        };
        mediaRec.start();
        $('#recBtn').disabled = true; $('#stopBtn').disabled = false;
        toast('Nagrywanie‚Ä¶');
      }catch(e){
        toast('Brak dostƒôpu do mikrofonu.');
      }
    }
    function stopRec(){
      if(mediaRec && mediaRec.state !== 'inactive'){ mediaRec.stop(); }
      $('#recBtn').disabled = false; $('#stopBtn').disabled = true;
    }

    // Drawer
    const drawer = $('#drawer');
    function openDrawer(){ drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false'); }
    function closeDrawer(){ drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); }

    // Wire events
    loadUrl();
    $('#saveUrl').addEventListener('click', saveUrl);
    $('#pingBtn').addEventListener('click', pingHealth);
    $('#sendBtn').addEventListener('click', sendPrompt);
    $('#clearBtn').addEventListener('click', ()=>{ promptEl.value=''; answerEl.value=''; });
    $('#ttsBtn').addEventListener('click', speak);
    $('#recBtn').addEventListener('click', startRec);
    $('#stopBtn').addEventListener('click', stopRec);
    $('#hamburger').addEventListener('click', openDrawer);
    $('#closeDrawer').addEventListener('click', closeDrawer);
    $('.backdrop').addEventListener('click', closeDrawer);

    // Auto-ping po starcie (je≈õli URL jest ustawiony)
    if(backendUrlInput.value) pingHealth();
  </script>
</body>
</html>
