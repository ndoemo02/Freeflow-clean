<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FreeFlow ‚Äî Voice to order</title>
  <meta name="theme-color" content="#0c0f14" />
  <style>
    :root{
      --bg:#0c0f14; --panel:#141823; --card:#111625; --btn:#1f2737; --txt:#e7edf7; --muted:#98a2b3; --accent:#ff7a18;
    }
    *{box-sizing:border-box} html,body{height:100%} body{
      margin:0;background:radial-gradient(80vw 80vh at 70% -10%,#1b2233 5%,#0c0f14 50%),var(--bg);
      color:var(--txt);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    }
    a{color:inherit;text-decoration:none}
    .shell{max-width:1100px;margin:0 auto;padding:18px}
    .row{display:flex;align-items:center;gap:12px}
    .brand{font-size:26px;font-weight:800}
    .brand span{color:var(--accent)}
    .spacer{flex:1}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:var(--card);border:1px solid #20283a}
    .muted{color:var(--muted)}
    .icon-btn{width:42px;height:42px;border-radius:12px;border:1px solid #20283a;background:var(--card);display:grid;place-items:center;cursor:pointer}
    .cart-dot{position:absolute;top:-6px;right:-6px;background:#ff8c3a;color:#000;font-weight:700;border-radius:999px;padding:0 6px;font-size:12px}
    .panel{background:var(--panel);border:1px solid #20283a;border-radius:18px;padding:18px}
    .h2{font-size:18px;margin:0 0 10px}
    input,textarea{width:100%;background:#0f1420;border:1px solid #20283a;border-radius:12px;color:var(--txt);padding:12px 14px;outline:none}
    button{background:var(--btn);border:1px solid #26314a;color:var(--txt);padding:12px 14px;border-radius:12px;cursor:pointer}
    button.primary{background:#1e824c;border-color:#2aa866}
    .grid{display:grid;gap:14px}
    @media(min-width:800px){.grid{grid-template-columns:1fr 1fr}}
    .chip{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:12px;border:1px dashed #2a3246;background:#0f1420}
    .bottom{position:fixed;inset:auto 0 16px 0}
    /* Drawer */
    .drawer-mask{position:fixed;inset:0;background:#0008;opacity:0;pointer-events:none;transition:.2s}
    .drawer{position:fixed;top:0;right:-420px;width:420px;max-width:95vw;height:100%;background:var(--panel);border-left:1px solid #20283a;transition:.25s;padding:18px;overflow:auto}
    .drawer.open~.drawer-mask{opacity:1;pointer-events:auto}
    .drawer.open{right:0}
  </style>
</head>
<body>
  <header class="shell row">
    <div class="brand"><span>Free</span>Flow</div>
    <div class="spacer"></div>
    <div class="row" style="gap:10px">
      <div class="icon-btn" title="Koszyk" style="position:relative">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 6h15l-2 10H8L6 6Z" stroke="#e7edf7"/><path d="M6 6l-2-2" stroke="#e7edf7"/></svg>
        <div class="cart-dot" id="cartCount">0</div>
      </div>
      <div class="icon-btn" id="btnOpenMenu" title="Menu">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 7h16M4 12h16M8 17h12" stroke="#e7edf7" stroke-width="1.6" stroke-linecap="round"/></svg>
      </div>
    </div>
  </header>

  <main class="shell grid">
    <!-- KONFIG BACKENDU -->
    <section class="panel">
      <h2 class="h2">URL backendu (Vercel)</h2>
      <div class="row" style="gap:10px">
        <input id="backendUrl" placeholder="https://twoj-backend.vercel.app" />
        <button id="btnSave">Zapisz</button>
        <button id="btnPing">Ping /health</button>
      </div>
      <p class="muted" id="statusText">Stan: nieznany</p>
    </section>

    <!-- WYSZUKIWANIE -->
    <section class="panel">
      <h2 class="h2">Wyszukiwanie po lokalizacji</h2>
      <div class="row" style="gap:10px">
        <input id="searchCity" placeholder="Wpisz miasto lub adres‚Ä¶" />
        <button id="btnSearch">üîé</button>
      </div>
    </section>

    <!-- ASYSTENT -->
    <section class="panel" style="grid-column:1/-1">
      <div class="row" style="gap:12px;justify-content:space-between">
        <h2 class="h2" style="margin:0">Asystent ‚Äî kr√≥tkie odpowiedzi PL</h2>
        <span class="muted pill" id="modelPill">model: gpt-4o-mini</span>
      </div>
      <textarea id="prompt" rows="4" placeholder="Np. Zam√≥wiƒá dwie pizze na Kazimierzu ‚Äî jaka dzielnica?"></textarea>
      <div class="row" style="gap:10px;margin-top:10px">
        <button class="primary" id="btnAsk">Wy≈õlij do /api/gpt</button>
        <button id="btnClear">Wyczy≈õƒá</button>
      </div>
      <div id="answer" class="chip" style="margin-top:12px;display:none"></div>
    </section>
  </main>

  <!-- DOLNY PASEK (mikrofon + kategorie) -->
  <div class="bottom shell">
    <div class="row" style="gap:12px;justify-content:space-between;flex-wrap:wrap">
      <div class="chip" style="flex:1;min-width:260px">
        <span style="width:10px;height:10px;border-radius:999px;background:#50e3a4;display:inline-block"></span>
        <span class="muted">M√≥w tutaj‚Ä¶</span>
        <div class="spacer"></div>
        <button>üé§</button>
      </div>
      <div class="row" style="gap:10px;flex-wrap:wrap">
        <button class="pill">üçΩÔ∏è Jedzenie</button>
        <button class="pill">üöï Taxi</button>
        <button class="pill">üè® Hotele</button>
        <button class="pill">‚Ä¶</button>
      </div>
    </div>
  </div>

  <!-- DRAWER -->
  <aside id="drawer" class="drawer" aria-hidden="true">
    <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:8px">
      <div class="brand"><span>Free</span>Flow</div>
      <div class="icon-btn" id="btnCloseMenu" title="Zamknij">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6L6 18" stroke="#e7edf7" stroke-width="1.6" stroke-linecap="round"/></svg>
      </div>
    </div>
    <p class="muted" id="dbg">DEBUG: Menu otwarte, expanded: brak, showAuthModal: false</p>

    <div class="panel" style="margin-bottom:14px">
      <div class="row" style="gap:8px"><strong>Klient Prywatny</strong><div class="spacer"></div></div>
      <div class="grid">
        <button>Zaloguj siƒô</button>
        <button>Zarejestruj konto</button>
        <button>Moje zam√≥wienia</button>
        <button>Ulubione restauracje</button>
      </div>
    </div>

    <div class="panel" style="margin-bottom:14px">
      <div class="row" style="gap:8px"><strong>Firma</strong><div class="spacer"></div></div>
      <div class="grid">
        <button>Panel firmy</button>
        <button>Fakturowanie</button>
      </div>
    </div>

    <div class="panel">
      <div class="row" style="gap:8px"><strong>Wsparcie i Ustawienia</strong><div class="spacer"></div></div>
      <div class="grid">
        <button>FAQ / pomoc</button>
        <button>Ustawienia aplikacji</button>
        <button>Jƒôzyk / waluta</button>
      </div>
    </div>
  </aside>
  <div id="drawerMask" class="drawer-mask"></div>

  <script>
    // --- STORAGE + UI helpers
    const $ = s => document.querySelector(s);
    const backendKey = 'freeflow.backendUrl';
    const elUrl = $('#backendUrl'), elStatus = $('#statusText'), elAns = $('#answer');

    function loadBackend() {
      const v = localStorage.getItem(backendKey) || '';
      if (v) elUrl.value = v;
      paintStatus('Stan: ' + (v ? 'skonfigurowany' : 'nieznany'));
    }
    function saveBackend() {
      const v = (elUrl.value || '').trim().replace(/\/+$/,'');
      localStorage.setItem(backendKey, v);
      paintStatus('Zapisano URL backendu');
    }
    function getBase(){ return (localStorage.getItem(backendKey) || '').replace(/\/+$/,''); }
    function paintStatus(t){ elStatus.textContent = t; }

    // --- Drawer
    const drawer = $('#drawer'), mask = $('#drawerMask');
    $('#btnOpenMenu').onclick = () => { drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false'); }
    $('#btnCloseMenu').onclick = mask.onclick = () => { drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true'); }

    // --- Ping /health
    async function ping() {
      const base = getBase();
      if(!base){ paintStatus('Ustaw najpierw URL backendu'); return; }
      try{
        const r = await fetch(base + '/api/health', {headers:{'accept':'application/json'}});
        const ok = r.ok ? 'OK' : r.status;
        paintStatus('Ping: ' + ok);
      }catch(e){ paintStatus('Ping b≈ÇƒÖd: ' + e.message); }
    }

    // --- Ask /api/gpt
    async function ask(){
      const base = getBase();
      if(!base){ elAns.style.display='block'; elAns.textContent='Ustaw URL backendu.'; return; }
      const prompt = ($('#prompt').value || '').trim();
      if(!prompt){ elAns.style.display='block'; elAns.textContent='Wpisz pytanie.'; return; }
      elAns.style.display='block'; elAns.textContent='‚Ä¶';
      try{
        const r = await fetch(base + '/api/gpt', {
          method:'POST',
          headers:{'content-type':'application/json'},
          body: JSON.stringify({ prompt })
        });
        const data = await r.json().catch(()=> ({}));
        if(!r.ok) throw new Error((data && data.error) || ('HTTP '+r.status));
        elAns.textContent = data.reply || '(pusta odpowied≈∫)';
      }catch(e){ elAns.textContent = 'B≈ÇƒÖd: ' + e.message; }
    }

    // --- Wire
    $('#btnSave').onclick = saveBackend;
    $('#btnPing').onclick = ping;
    $('#btnAsk').onclick = ask;
    $('#btnClear').onclick = () => { $('#prompt').value=''; elAns.style.display='none'; }
    $('#btnSearch').onclick = () => alert('TODO: wyszukiwarka');

    // Init
    loadBackend();
  </script>
</body>
</html>
